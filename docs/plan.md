# План разработки: Телеграм-бот «Квесты Развития»

## Итерация 0: Инициализация проекта ✅
**Цель:** Настройка базовой структуры проекта и репозитория

- [x] Создание CLAUDE.md с инструкциями для разработки
- [x] Создание plan.md с планом итераций
- [x] Инициализация git репозитория
- [x] Создание .gitignore
- [x] Первый коммит
- [x] Связывание с удаленным репозиторием (https://github.com/borisgern/kids-development-bot.git)
- [x] Push в main ветку

## Итерация 1: Базовая структура Next.js проекта ✅
**Цель:** Создание основы приложения на Next.js с TypeScript

- [x] Инициализация Next.js проекта с TypeScript
- [x] Настройка структуры директорий
- [x] Создание базовых конфигурационных файлов (tsconfig.json, next.config.js)
- [x] Настройка переменных окружения (.env.example)
- [x] Установка необходимых зависимостей (grammy)
- [x] Создание ecosystem.config.js для PM2

**Результат:** Работающий каркас Next.js приложения

## Итерация 2: Парсинг и управление данными ✅
**Цель:** Реализация Story 1 и Story 2 - парсинг MD файлов и работа с db.json

- [x] Создание тестовых MD файлов с задачами
- [x] Реализация парсера для извлечения задач из MD файлов
- [x] Создание структуры db.json
- [x] Реализация сервиса для работы с db.json (чтение/запись)
- [x] Написание unit тестов для парсера

**Результат:** Работающий механизм извлечения задач и их сохранения

## Итерация 3: Telegram Bot - базовый функционал ✅
**Цель:** Реализация Story 10, 11, 14 - подписка/отписка пользователей

- [x] Настройка Telegram Bot API
- [x] Реализация обработчика команды /start
- [x] Реализация приветственного сообщения
- [x] Реализация обработчика команды /stop
- [x] Сохранение/удаление chat_id в db.json
- [x] Тестирование команд в реальном Telegram боте

**Результат:** Работающие команды подписки/отписки

## Итерация 4: Логика выбора и отправки задач ✅
**Цель:** Реализация Story 4, 5, 6, 7 - core логика выбора и рассылки

- [x] Реализация алгоритма выбора 3 случайных неотправленных задач
- [x] Реализация пометки задач как отправленных
- [x] Реализация механизма сброса цикла при исчерпании пула
- [x] Реализация форматирования сообщения для Telegram
- [x] Реализация broadcast функции для всех подписчиков
- [x] Написание integration тестов

**Результат:** Готовая логика выбора и отправки задач

## Итерация 5: Cron и планировщик
**Цель:** Реализация Story 3 - автоматический запуск в 7:00 WEST

- [ ] Реализация API endpoint для ручного запуска рассылки
- [ ] Настройка node-cron или системного cron
- [ ] Настройка правильной timezone (WEST)
- [ ] Тестирование cron job
- [ ] Добавление логирования (Story 13)

**Результат:** Автоматическая ежедневная рассылка

## Итерация 6: Обработка ошибок и устойчивость
**Цель:** Реализация Story 8 - graceful error handling

- [ ] Обработка ошибок парсинга файлов
- [ ] Обработка ошибок отправки сообщений
- [ ] Реализация отправки сообщений об ошибках пользователям
- [ ] Добавление retry логики для отправки сообщений
- [ ] Улучшение логирования ошибок

**Результат:** Устойчивая к сбоям система

## Итерация 7: Подготовка к деплою на VPS
**Цель:** Финальная подготовка и документация

- [ ] Создание скрипта для первичной настройки на VPS
- [ ] Документация процесса деплоя
- [ ] Настройка переменных окружения для production
- [ ] Тестирование всего flow end-to-end
- [ ] Создание README.md с инструкциями

**Результат:** Готовое к деплою приложение

## Итерация 8: Деплой на VPS
**Цель:** Развертывание на production сервере

- [ ] Клонирование репозитория на VPS
- [ ] Установка Node.js и PM2
- [ ] Настройка переменных окружения
- [ ] Запуск приложения через PM2
- [ ] Настройка автозапуска при перезагрузке сервера
- [ ] Проверка работы cron job
- [ ] Мониторинг первых дней работы

**Результат:** Работающий в production бот

---

## Статус проекта

**Текущая итерация:** 4 ✅ Завершена  
**Последнее обновление:** 09.09.2025  
**Следующий шаг:** Итерация 5 - Cron и планировщик

## Примечания

- После завершения каждой итерации необходимо обновить статус в этом файле
- Каждая завершенная итерация должна быть закоммичена и запушена в репозиторий
- При необходимости итерации могут быть скорректированы в процессе разработки